<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>The Kecc compiler. | Mountagha’s Blog</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="The Kecc compiler." />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A corner of the web where I will share my passions with you." />
<meta property="og:description" content="A corner of the web where I will share my passions with you." />
<link rel="canonical" href="/kecc-compiler.html" />
<meta property="og:url" content="/kecc-compiler.html" />
<meta property="og:site_name" content="Mountagha’s Blog" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="The Kecc compiler." />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"A corner of the web where I will share my passions with you.","headline":"The Kecc compiler.","url":"/kecc-compiler.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/assets/css/style.css?v=7149327eb2917a452d6085b5cda0c3870ff482f5">
    <nav>
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/about/">About</a></li>
  </ul>
</nav>

<style>
nav ul {
  list-style-type: none;
  padding: 0;
  display: flex;
  gap: 10px;
  justify-content: right;
}

nav ul li {
  display: inline;
}

nav ul li a {
  text-decoration: none;
  padding: 10px;
  background-color: #4CAF50;
  color: white;
  border-radius: 5px;
}

nav ul li a:hover {
  background-color: #45a049;
}
</style>


  </head>
  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <header class="page-header" role="banner">
      <h1 class="project-name">The Kecc compiler.</h1>
      <h2 class="project-tagline">A corner of the web where I will share my passions with you.</h2>
      
        <a href="https://github.com/Mountagha" target="_blank" class="btn">GitHub</a>
        <a href="https://www.linkedin.com/in/mamadou-mountagha-bah-b40701141/" target="_blank" class="btn">LinkedIn</a>
      
      
    </header>

    <main id="content" class="main-content" role="main">
      <h2 id="the-kecc-compiler">The Kecc compiler.</h2>
<p>This is my second post on compilers. 
KECC is C compiler developped at <a href="https://www.kaist.ac.kr/en/">KAIST</a> lab using the Rust programming language. There are few reasons that made me got into another compiler project</p>
<ul>
  <li>I recently learned Rust and wanted to used it in a real life project for more understanding.</li>
  <li>Unlike <a href="/cool-compiler.html">COOL compiler</a> which is developped in a monolithic way, KECC adopts the very recent compiler development technics which made it very modular and closed to what is used in real compilers structures like <a href="https://llvm.org/">LLVM</a>.</li>
  <li>This is my occasion to implement real life optimizations used in real life compilers</li>
  <li>the KECC compiler is provided with a fair amount skeleton code which is most like 
contributing to a open Source project. For somebody aspiring to have a fair
amount of contribution to big open source projects like <a href="https://github.com/pytorch/pytorch">Pytorch</a> and <a href="LLVM">link</a>,
this is a perfect way to my maiden voyage into open source contribution.</li>
</ul>

<h3 id="kecc-organization">KECC organization:</h3>
<p>Unlike the <a href="/cool-compiler.html">Cool Compiler</a> KECC emphasizes more on the backend part or would I say emphasizes less on the front part 
of the compiler (lexer parser) which are handled by an external crate lang_c which parses the C
language into an AST. The main part of the project consists of translating the 
provided AST into an <a href="https://en.wikipedia.org/wiki/Static_single-assignment_form">SSA-based intermediate representation (IR)</a> 
then applied some optimizations upon the generated IR (Gloval Value Numbering, constant propagation mem2reg…) 
and finish by emitting a <a href="https://fr.wikipedia.org/wiki/RISC-V">RISC-V</a> assembly program.</p>

<h3 id="parser">parser</h3>
<p>KAIST parser is entirely handled by <a href="https://crates.io/crates/lang-c">Rust Lang_c crate</a> which parses the source code into an AST whose root is the Translation unit. The root got external declarations as children which also got their children (You know the music).</p>

<pre><code class="language-Rust">
// From 6.9 External definitions

/// Entire C source file after preprocessing
///
/// (C11 6.9)
#[derive(Debug, PartialEq, Clone)]
pub struct TranslationUnit(pub Vec&lt;Node&lt;ExternalDeclaration&gt;&gt;);

/// Top-level elements of a C program
///
/// (C11 6.9)
#[derive(Debug, PartialEq, Clone)]
pub enum ExternalDeclaration {
    Declaration(Node&lt;Declaration&gt;),
    StaticAssert(Node&lt;StaticAssert&gt;),
    FunctionDefinition(Node&lt;FunctionDefinition&gt;),
}

/// Function definition
///
/// (C11 6.9.1)
#[derive(Debug, PartialEq, Clone)]
pub struct FunctionDefinition {
    /// Return type of the function, possibly mixed with other specifiers
    pub specifiers: Vec&lt;Node&lt;DeclarationSpecifier&gt;&gt;,
    /// Contains function name and parameter list
    pub declarator: Node&lt;Declarator&gt;,
    /// K&amp;R style parameter type definitions (C11 6.9.1 §6)
    pub declarations: Vec&lt;Node&lt;Declaration&gt;&gt;,
    /// Body of the function.
    pub statement: Node&lt;Statement&gt;,
}

</code></pre>
<p>In that part of the project, an AST printer was asked to be implemented, going through the AST and then regerenating the C code. The way the parser is tested is pretty clever. The AST printer goes through the AST parser and then generate back the original C source code. To test it, the generated code was parsed again, and the resulting AST was compared with the original to ensure they were identical.</p>

<pre><code class="language-Rust">
impl WriteLine for TranslationUnit {
    fn write_line(&amp;self, indent: usize, write: &amp;mut dyn Write) -&gt; Result&lt;()&gt; {
        for ext_decl in &amp;self.0 {
            ext_decl.write_line(indent, write)?;
            writeln!(write)?;
        }
        Ok(())
    }
}

impl WriteLine for ExternalDeclaration {
    fn write_line(&amp;self, indent: usize, write: &amp;mut dyn Write) -&gt; Result&lt;()&gt; {
        match self {
            Self::Declaration(decl) =&gt; decl.write_line(indent, write),
            Self::StaticAssert(_) =&gt; panic!(),
            Self::FunctionDefinition(fdef) =&gt; fdef.write_line(indent, write),
        }
    }
}

</code></pre>

<h3 id="ir-generation">IR generation</h3>
<p>The intermediate representation generation part is pretty challenging as it is the first time I was experiencing it. What makes</p>
<h3 id="cfg-simplification">CFG simplification</h3>
<h4 id="constant-propagation">constant propagation</h4>
<h3 id="deadcode-elimination">Deadcode Elimination</h3>
<h3 id="memory-to-register-mem2reg">Memory to Register (mem2reg)</h3>

<h2 id="conclusion">Conclusion</h2>

<p><a href="./">back</a></p>


      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/Mountagha">Mountagha.github.io</a> is maintained by <a href="https://github.com/Mountagha">Mountagha</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>
  </body>
</html>